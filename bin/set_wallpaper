#!/bin/sh
#-------------------------------------------------------------------------------------------------#
# AUTHOR:  Andrew Michaud - https://andrewmichaud.com                                             #
# FILE:    set_wallpaper                                                                          #
# PURPOSE: Script to set wallpaper with feh with some randomness.                                 #
# UPDATED: 2015-04-04                                                                             #
# LICENSE: ISC                                                                                    #
#-------------------------------------------------------------------------------------------------#
if [ "$(pgrep -c Xorg)" = 0 ]; then
    echo "Need X!"
    exit 1
fi

if [ -z "$1" ]; then
    echo "Must provide directory!"
    echo "usage: set_wallpaer [wallpaper_directory] [shuf]"
    echo "shuf as second argument is optional and regenerates wallpaper list."
    exit 1
fi

if [ -z "$XDG_CONFIG_HOME" ]; then
    XDG_CONFIG_HOME="$HOME/.config"
fi
PAPER_HOME="$XDG_CONFIG_HOME/wallpaper"

if [ ! -d "$PAPER_HOME" ]; then
    echo "Creating wallpaper script dir $PAPER_HOME"
    mkdir -p "$PAPER_HOME"
fi

if [ ! -f "$XDG_CONFIG_HOME/wallpaper/list" ] || [ "$2" = "shuf" ]; then
    echo "Updating wallpaper script wallpaper list file at $PAPER_HOME/list"
    find "$1" -type f | shuf > "$PAPER_HOME/list"
fi

# Set first listed wallpaper as current wallpaper, then put it at the back of the list.
FIRST=$(head -n1 "$PAPER_HOME/list")

echo "Setting wallpaper to $FIRST"
feh --no-fehbg --bg-max "$FIRST"

echo "Updating list of papers to push $FIRST to end."
tail -n +2 "$PAPER_HOME/list" > "$PAPER_HOME/tmp"
cat "$PAPER_HOME/tmp" > "$PAPER_HOME/list"
echo "$FIRST" >> "$PAPER_HOME/list"
