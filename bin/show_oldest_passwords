#!/bin/sh
#-------------------------------------------------------------------------------------------------#
# AUTHOR:  Andrew Michaud - https://andrewmichaud.com                                             #
# FILE:    show_oldest_passwords                                                                  #
# PURPOSE: Show oldest (LRU) passwords in the Pass password manager.                              #
# UPDATED: 2016-08-24                                                                             #
# LICENSE: ISC                                                                                    #
#-------------------------------------------------------------------------------------------------#

FORMAT_STRING='%TY-%Tm-%TdT%TH:%TM %p\n'
DEFAULT_COUNT=15
REGEX="password.gpg$"

# Hand-rolled argument processing, woo.
if [ ! -z "$1" ]; then
    COUNT="$1"
else
    COUNT=$DEFAULT_COUNT
fi

if [ ! -z "$2" ]; then
    DIR="$2"
fi

if [ -z "$2" ] && [ ! -z "$PASSWORD_STORE_DIR" ]; then
    DIR="$PASSWORD_STORE_DIR"
else
    echo "Either PASSWORD_STORE_DIR must be set, or you must provide a directory"
    echo "Usage: show_oldest_passwords [count] [dir]"
    exit 1
fi

find "$DIR" -type f -printf "$FORMAT_STRING" | grep -E "$REGEX" | sort | head -n $COUNT
