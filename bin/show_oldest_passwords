#!/bin/sh

# Hand-rolled argument processing, woo.
if [ ! -z "$1" ]; then
    COUNT="$1"
else
    COUNT=15
fi

if [ ! -z "$2" ]; then
    DIR="$2"
fi

if [ -z "$2" ] && [ ! -z "$PASSWORD_STORE_DIR" ]; then
    DIR="$PASSWORD_STORE_DIR"
else
    echo "Either PASSWORD_STORE_DIR must be set, or you must provide a directory"
    echo "Usage: show_oldest_passwords [count] [dir]"
    exit 1
fi

find "$DIR" -type f -printf '%TY-%TM-%TdT%TH:%TM %p\n' | grep -E "password.gpg$" | sort | head -n $COUNT
