#!/bin/sh
#-------------------------------------------------------------------------------------------------#
# author:  andrew michaud - https://andrewmichaud.com                                             #
# file:    menu                                                                                   #
# purpose: file for choosing things with dmenu                                                    #
# updated: 2017-12-22                                                                             #
# license: isc                                                                                    #
#-------------------------------------------------------------------------------------------------#
# choose something with dmenu. takes prefix and regex and type.
choose () {
    if [ -z "$1" ] || [ -z "$2" ] || [ -z "$3" ]; then
        echo "[menu] [ERROR] Not enough parameters given to choose!"
        exit 1
    fi
    echo "[menu] Mode $3"

    # Choose (wisely).
    choice=$(find "$1" -regex "$2" | sed "s|$1/||" | dmenu -i)
    [ -n "$choice" ] || exit
    echo "[menu] Selected '$choice'."
}

# passwords with pass password manager the standard UNIX password manager
if [ "$1" = "pass" ]; then
    # copy pass to clipboard
    XDG_PASS_DIR=$(xdg-user-dir PASS)
    choose "${XDG_PASS_DIR}" ".*\.\(gpg\)" "pass"
    export DISPLAY=":0"
    pass show -c "$(echo "$choice" | sed 's/.gpg$//')" 2>/dev/null

# videos with mpv
elif [ "$1" = "vid" ]; then
    # play
    XDG_VIDEOS_DIR=$(xdg-user-dir VIDEOS)
    choose "$XDG_VIDEOS_DIR" ".*\.\(mkv\|mp4\|avi\|vob\)" "video"
    nohup mpv "$XDG_VIDEOS_DIR/$choice"

# music with mpd
elif [ "$1" = "music" ]; then
    # Clear mpd playlist and play this playlist instead.
    XDG_MUSIC_DIR=$(xdg-user-dir MUSIC)
    choose "$XDG_MUSIC_DIR/playlists" ".*\.\(m3u\)" "music"
    mpc clear && mpc load "$(echo "$choice" | sed 's/.m3u$//')" && mpc play

else
    echo "[menu] Unsupported selection!"
    exit 1
fi
